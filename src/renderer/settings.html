<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>插件设置</title>
  <link rel="stylesheet" href="./settings.css" />
  <link rel="stylesheet" href="./remixicon-local.css" />
</head>

<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="logo">
        <img src="../../icon.ico" alt="Logo" />
        <span>LessonPlugin</span>
      </div>
      <nav>
        <button class="nav-item active" data-page="plugins"><i class="ri-puzzle-line"></i> 插件管理</button>
        <button class="nav-item" data-page="market"><i class="ri-store-2-line"></i> 功能市场</button>
        <button class="nav-item" data-page="general"><i class="ri-settings-3-line"></i> 通用设置</button>
        <button class="nav-item" data-page="profiles"><i class="ri-archive-line"></i> 档案管理</button>
        <button class="nav-item" data-page="automation"><i class="ri-timer-line"></i> 自动执行</button>
        <button class="nav-item" data-page="npm" style="display: none;"><i class="ri-box-3-line"></i> 依赖管理</button>
        <button class="nav-item" data-page="debug" style="display: none;"><i class="ri-tools-line"></i> 调试功能</button>
        <button class="nav-item" data-page="about"><i class="ri-information-line"></i> 关于软件</button>
      </nav>
    </aside>
    <div class="main-col">
      <div class="titlebar">
        <div class="drag"></div>
        <div class="window-actions">
          <button class="win-btn" data-act="minimize" title="最小化"><i style="font-size: 18px;"
              class="ri-subtract-line"></i></button>
          <button class="win-btn max" data-act="maximize" title="最大化"><i class="ri-checkbox-blank-line"></i></button>
          <button class="win-btn close" data-act="close" title="关闭"><i style="font-size: 18px;"
              class="ri-close-line"></i></button>
        </div>
      </div>
      <main id="content">
        <section id="page-plugins">
          <header>
            <h1>插件管理</h1>
            <p>对已安装的插件进行管理或配置</p>
          </header>
          <div id="drop-install" class="drop-install">
            <i class="ri-folder-zip-line"></i>
            拖入插件ZIP安装包以开始安装
          </div>
          <div id="plugins" class="plugins"></div>
        </section>
        <section id="page-market" hidden>
          <header>
            <h1>功能市场</h1>
            <p>浏览、发现与获取功能模块（即将上线）</p>
          </header>
          <div class="panel">
            <div class="muted" style="padding: 12px;">功能市场正在建设中，敬请期待。</div>
          </div>
        </section>
        <section id="page-general" hidden>
          <header>
            <h1>通用设置</h1>
            <p>应用基础设置、启动页与名言配置</p>
          </header>
          <!-- 子夹（子页面）导航 -->
          <div class="subnav">
            <button class="sub-item active" data-sub="basic"><i class="ri-settings-2-line"></i> 基本设置</button>
            <button class="sub-item" data-sub="splash"><i class="ri-window-line"></i> 启动页面</button>
            <button class="sub-item" data-sub="time"><i class="ri-time-line"></i> 时间与日期</button>
            <button class="sub-item" data-sub="data"><i class="ri-folder-line"></i> 数据目录</button>
          </div>

          <!-- 启动页与名言设置（合并） -->
          <div id="general-splash" class="panel" hidden>
            <div class="form">
              <!-- 启动页开关 -->
              <div class="setting-item">
                <div class="setting-icon"><i class="ri-window-line"></i></div>
                <div class="setting-main">
                  <div class="setting-title">启用启动页</div>
                  <div class="setting-desc">开启后应用启动时显示加载页面。</div>
                </div>
                <div class="setting-action">
                  <label class="switch">
                    <input id="splash-enabled" type="checkbox" />
                    <span class="slider"></span>
                  </label>
                </div>
              </div>

              <!-- 显示名言开关 -->
              <div class="setting-item">
                <div class="setting-icon"><i class="ri-quill-pen-line"></i></div>
                <div class="setting-main">
                  <div class="setting-title">显示名言</div>
                  <div class="setting-desc">关闭后不显示名言，启动页高度减小。</div>
                </div>
                <div class="setting-action">
                  <label class="switch">
                    <input id="splash-quote-enabled" type="checkbox" />
                    <span class="slider"></span>
                  </label>
                </div>
              </div>

              <!-- 名言来源选择（按钮组样式） -->
              <div class="setting-item">
                <div class="setting-icon"><i class="ri-chat-quote-line"></i></div>
                <div class="setting-main">
                  <div class="setting-title">名言来源</div>
                  <div class="setting-desc">可从 API 获取或使用本地列表。</div>
                  <div class="options" role="group" aria-label="名言来源">
                    <input type="radio" id="quote-hitokoto" name="quoteSource" value="hitokoto" />
                    <label for="quote-hitokoto"><i class="ri-link-m"></i> 一言 API</label>
                    <input type="radio" id="quote-local" name="quoteSource" value="local" />
                    <label for="quote-local"><i class="ri-file-text-line"></i> 本地列表</label>
                  </div>
                </div>
                <div class="setting-action"></div>
              </div>

              <!-- API 设置 -->
              <div class="setting-item" id="field-api">
                <div class="setting-icon"><i class="ri-link-m"></i></div>
                <div class="setting-main">
                  <div class="setting-title">API 地址</div>
                  <div class="setting-desc">默认 https://v1.hitokoto.cn/</div>
                  <div class="inline">
                    <input id="api-url" type="text" placeholder="https://v1.hitokoto.cn/" />
                    <button id="api-test" class="btn primary"><i class="ri-refresh-line"></i> 测试获取</button>
                  </div>
                  <div id="api-sample" class="muted"></div>
                </div>
                <div class="setting-action"></div>
              </div>

              <!-- 本地列表编辑 -->
              <div class="setting-item" id="field-local">
                <div class="setting-icon"><i class="ri-file-text-line"></i></div>
                <div class="setting-main">
                  <div class="setting-title">本地名言列表</div>
                  <div class="setting-desc">以“文本 | 来源”两列编辑，支持从TXT导入。</div>
                  <button id="open-array-editor" class="btn secondary"><i class="ri-edit-2-line"></i> 编辑列表</button>
                </div>
                <div class="setting-action"></div>
              </div>
            </div>
          </div>

          <!-- 基础设置子页（仅保留启动相关） -->
          <div id="general-basic" class="panel">
            <div class="form">
              <!-- 自启动开关 -->
              <div class="setting-item">
                <div class="setting-icon"><i class="ri-play-line"></i></div>
                <div class="setting-main">
                  <div class="setting-title">开机自启动</div>
                  <div class="setting-desc">系统登录后自动启动应用。</div>
                </div>
                <div class="setting-action">
                  <label class="switch">
                    <input id="autostart-enabled" type="checkbox" />
                    <span class="slider"></span>
                  </label>
                </div>
              </div>

              <!-- 高优先级自启动 -->
              <div class="setting-item" style="display: none;">
                <div class="setting-icon"><i class="ri-rocket-line"></i></div>
                <div class="setting-main">
                  <div class="setting-title">高优先级自启动</div>
                  <div class="setting-desc">以隐藏模式启动并提高启动优先级。</div>
                </div>
                <div class="setting-action">
                  <label class="switch">
                    <input id="autostart-high" type="checkbox" />
                    <span class="slider"></span>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- 时间与数据 子页 -->
          <div id="general-time" class="panel" hidden>
            <div class="form">
              <!-- 精确时间开关 -->
              <div class="setting-item">
                <div class="setting-icon"><i class="ri-time-line"></i></div>
                <div class="setting-main">
                  <div class="setting-title">使用精确时间</div>
                  <div class="setting-desc">为插件提供精确当前时间接口（可设置偏移）。</div>
                </div>
                <div class="setting-action">
                  <label class="switch">
                    <input id="precise-time" type="checkbox" />
                    <span class="slider"></span>
                  </label>
                </div>
              </div>

              <!-- 学期开始日期（用于单双周判断与偏移基准） -->
              <div class="setting-item">
                <div class="setting-icon"><i class="ri-calendar-event-line"></i></div>
                <div class="setting-main">
                  <div class="setting-title">学期开始日期</div>
                  <div class="setting-desc">用于单双周判断与时间偏移基准。</div>
                </div>
                <div class="setting-action">
                  <div class="inline">
                    <input id="semester-start" type="date" />
                    <label class="switch" title="从下周开始（反转单双周）" style="margin-left:12px;">
                      <input id="biweek-offset" type="checkbox" />
                      <span class="slider"></span>
                    </label>
                    <span class="muted" style="margin-left:6px;">单双周偏移</span>
                  </div>
                </div>
              </div>

              <!-- 时间偏移值（秒） -->
              <div class="setting-item">
                <div class="setting-icon"><i class="ri-slideshow-line"></i></div>
                <div class="setting-main">
                  <div class="setting-title">时间偏移值</div>
                  <div class="setting-desc">对当前时间进行加减（单位：秒，负数为减）。</div>
                </div>
                <div class="setting-action">
                  <div class="inline">
                    <input id="time-offset" type="number" step="1" />
                  </div>
                </div>
              </div>

              <!-- 自动时间偏移（每天叠加秒数） -->
              <div class="setting-item">
                <div class="setting-icon"><i class="ri-calendar-2-line"></i></div>
                <div class="setting-main">
                  <div class="setting-title">自动时间偏移</div>
                  <div class="setting-desc">每天自动叠加该偏移值（单位：秒，负数为减）。</div>
                </div>
                <div class="setting-action">
                  <div class="inline">
                    <input id="auto-offset-daily" type="number" step="1" />
                  </div>
                </div>
              </div>

              <!-- NTP服务器地址设置 -->
              <div class="setting-item">
                <div class="setting-icon"><i class="ri-signal-tower-line"></i></div>
                <div class="setting-main">
                  <div class="setting-title">NTP 服务器地址</div>
                  <div class="setting-desc">启用精确时间后，将从该 NTP 服务获取时间。</div>
                </div>
                <div class="setting-action">
                  <div class="inline">
                    <input id="ntp-server" type="text" placeholder="ntp.aliyun.com" />
                  </div>
                </div>
              </div>


            </div>
          </div>

          <!-- 数据目录 子页（从插件页面移回通用设置） -->
          <div id="general-data" class="panel" hidden>
            <div class="form">
              <!-- 数据目录操作 -->
              <div class="setting-item">
                <div class="setting-icon"><i class="ri-folder-line"></i></div>
                <div class="setting-main">
                  <div class="setting-title">数据目录</div>
                  <div class="setting-desc">打开或更改应用数据目录（插件、配置等）。</div>
                  <div class="muted" id="user-data-path" style="margin-top:8px; word-break: break-all;"></div>
                </div>
                <div class="setting-action">
                  <div class="inline">
                    <button id="open-user-data" class="btn secondary"><i class="ri-folder-open-line"></i>
                      打开数据目录</button>
                    <button id="change-user-data" class="btn"><i class="ri-pencil-line"></i> 更改数据目录</button>
                  </div>
                </div>
              </div>

              <!-- 清理用户数据（卸载前可选） -->
              <div class="setting-item">
                <div class="setting-icon"><i class="ri-delete-bin-6-line"></i></div>
                <div class="setting-main">
                  <div class="setting-title">清理用户数据</div>
                  <div class="setting-desc">删除插件与配置等用户数据（建议卸载前执行）。</div>
                </div>
                <div class="setting-action">
                  <button id="cleanup-user-data" class="btn danger"><i class="ri-eraser-line"></i> 清理插件与配置</button>
                </div>
              </div>
            </div>
          </div>

          <!-- 本地列表编辑器模态框 -->
          <div id="array-modal" class="modal" hidden>
            <div class="modal-backdrop"></div>
            <div class="modal-dialog">
              <div class="modal-title"><i class="ri-table-2"></i> 编辑名言列表（文本 + 来源）</div>
              <div class="modal-body">
                <div id="array-list" class="array-list"></div>
                <div class="array-actions">
                  <button id="array-add" class="btn secondary"><i class="ri-add-line"></i> 添加一条</button>
                  <label class="btn secondary">
                    <i class="ri-file-text-line"></i> 从TXT导入（每行：文本|来源）
                    <input id="array-import" type="file" accept=".txt" hidden />
                  </label>
                </div>
              </div>
              <div class="modal-actions">
                <button id="array-cancel" class="btn secondary">取消</button>
                <button id="array-save" class="btn primary">保存</button>
              </div>
            </div>
          </div>

        </section>

        <!-- 档案管理页面 -->
        <section id="page-profiles" hidden>
          <header>
            <h1>档案管理</h1>
            <p>维护学生列表，支持文本导入与筛选</p>
          </header>
          <!-- 子夹（子页面）导航，与通用设置相同结构 -->
          <div class="subnav">
            <button class="sub-item active" data-sub="students"><i class="ri-user-3-line"></i> 学生列表</button>
          </div>
          <div id="profiles-students" class="panel">
            <div class="profiles-toolbar">
              <button id="profiles-import-toggle" class="btn secondary"><i class="ri-file-text-line"></i> 文本导入</button>
              <button id="profiles-add" class="btn secondary"><i class="ri-add-line"></i> 新增学生</button>
              <button id="profiles-save" class="btn primary"><i class="ri-save-3-line"></i> 保存</button>
              <span class="muted" style="margin-left: 8px;">提示：可直接复制 Excel 中纵向学生列表并粘贴</span>
            </div>
            <div id="profiles-import" class="profiles-import" hidden>
              <textarea id="profiles-import-text" placeholder="每行一个学生姓名"></textarea>
              <div class="import-actions">
                <button id="profiles-import-apply" class="btn primary"><i class="ri-download-2-line"></i> 导入到列表</button>
                <button id="profiles-import-cancel" class="btn secondary"><i class="ri-close-line"></i> 关闭</button>
              </div>
            </div>
            <div id="profiles-filters" class="profiles-filters"></div>
            <div class="profiles-table-wrap">
              <table class="profiles-table">
                <thead id="profiles-thead"></thead>
                <tbody id="profiles-tbody"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- 自动执行页面 -->
        <section id="page-automation" hidden>
          <header>
            <h1>自动执行</h1>
            <p>根据触发与条件自动执行任务</p>
          </header>
          <div class="panel automation">
            <div class="auto-left">
              <div class="auto-topbar">
                <button id="auto-add" class="btn primary"><i class="ri-add-line"></i> 新建任务</button>
                <button id="auto-filters-toggle" class="btn secondary"><i class="ri-filter-3-line"></i> 筛选</button>
              </div>
              <div id="auto-filters" class="auto-filters" hidden>
                <div class="chips">
                  <span class="chip" data-filter-source="user">来源：用户</span>
                  <span class="chip" data-filter-source="plugin">来源：插件</span>
                  <span class="chip" data-filter-source="shortcut">来源：快捷</span>
                </div>
                <div class="chips">
                  <span class="chip" data-filter-enabled="all">不限</span>
                  <span class="chip" data-filter-enabled="enabled">已启用</span>
                  <span class="chip" data-filter-enabled="disabled">未启用</span>
                </div>
              </div>
              <div id="auto-list" class="auto-list"></div>
            </div>
            <div class="auto-right">
              <div id="auto-editor" class="auto-editor">
                <div class="auto-editor-empty">从左侧选择任务或新建</div>
              </div>
            </div>
          </div>
        </section>

        <!-- 调试页面 -->
        <section id="page-debug" hidden>
          <header>
            <h1>调试</h1>
            <p>通过 Canvas 生成并释放 RemixIcon 到 icons 目录，用作托盘菜单一级图标。</p>
          </header>
          <div class="panel">
            <div class="form">
              <div class="setting-item">
                <div class="setting-icon"><i class="ri-tools-line"></i></div>
                <div class="setting-main">
                  <div class="setting-title">图标参数</div>
                  <div class="setting-desc">输入 RemixIcon 类名与颜色，渲染预览并保存为 PNG。</div>
                  <div class="inline">
                    <input id="debug-icon-class" type="text" placeholder="ri-settings-3-line" style="flex:1;" />
                    <input id="debug-filename" type="text" placeholder="文件名（如 ri-settings-3-line.png）"
                      style="flex:1; margin-left:8px;" />
                  </div>
                  <div class="inline" style="margin-top:8px;">
                    <label class="muted" style="margin-right:6px;">背景</label>
                    <input id="debug-bg" class="color-input" type="color" value="#111827" />
                    <label class="muted" style="margin-left:8px;">透明背景</label>
                    <input id="debug-transparent" type="checkbox" />
                    <label class="muted" style="margin:0 6px 0 12px;">前景</label>
                    <input id="debug-fg" class="color-input" type="color" value="#ffffff" />
                    <label class="muted" style="margin:0 6px 0 12px;">尺寸</label>
                    <input id="debug-size" type="number" value="256" min="64" max="1024" step="16" />
                  </div>
                </div>
                <div class="setting-action">
                  <button id="debug-release" class="btn primary"><i class="ri-upload-2-line"></i> 释放到 icons 目录</button>
                  <button id="debug-open-dir" class="btn secondary" style="margin-left:8px;"><i
                      class="ri-folder-2-line"></i> 打开 icons 目录</button>
                </div>
              </div>
            </div>
          </div>
          <div class="panel">
            <div class="shortcut-preview-grid">
              <canvas id="debug-canvas" class="preview-canvas" width="256" height="256"></canvas>
              <div class="preview-meta">
                <div class="muted">输出目录：<span id="debug-icons-path">—</span></div>
                <div class="muted" style="margin-top:6px;">提示：托盘图标来源优先用户数据 icons，其次应用内置。</div>
              </div>
            </div>
          </div>
        </section>

        <!-- 关于页面 -->
        <section id="page-about" hidden>
          <header>
            <h1>关于</h1>
            <p>LessonPlugin — 插件化大屏课堂辅助工具</p>
          </header>
          <div class="panel">
            <div class="about-hero">
              <img class="about-logo" src="../../icon.ico" alt="LessonPlugin" />
              <div class="about-title">
                <div class="name">LessonPlugin</div>
                <div class="tagline">插件化大屏课堂辅助工具</div>
              </div>
              <div class="about-badges">
                <span class="pill small">版本 <span id="about-version">—</span></span>
                <span class="pill small">Electron <span id="about-electron">—</span></span>
                <span class="pill small">Node <span id="about-node">—</span></span>
                <span class="pill small">Chrome <span id="about-chrome">—</span></span>
                <span class="pill small">平台 <span id="about-platform">—</span></span>
              </div>
            </div>
            <div class="about-links">
              <a href="https://github.com/Ris-Soft/LessonPlugin" target="_blank" class="btn"><i
                  class="ri-git-repository-line"></i> 仓库</a>
              <div class="spacer"></div>
              <button id="about-copy" class="btn secondary"><i class="ri-file-copy-2-line"></i> 复制版本信息</button>
              <button id="about-open-data" class="btn"><i class="ri-folder-2-line"></i> 打开数据目录</button>
            </div>
          </div>
          <div class="panel">
            <div class="contributors">
              <div class="section-title"><i class="ri-team-line"></i> 贡献者</div>
              <ul class="contributors-list horizontal">
                <li>
                  <div class="avatar"><i style="color: white;" class="ri-code-line"></i></div>
                  <div class="name">PYLXU</div>
                  <div class="role">主程序开发</div>
                </li>
                <li>
                  <div class="avatar"><i style="color: white;" class="ri-code-line"></i></div>
                  <div class="name">风吟残歌</div>
                  <div class="role">主程序开发</div>
                </li>
                <li>
                  <div class="avatar"><i style="color: white;" class="ri-palette-line"></i></div>
                  <div class="name">小震</div>
                  <div class="role">LOGO设计</div>
                </li>
              </ul>
            </div>
          </div>
          <div class="panel">
            <div class="credits">
              <div class="section-title"><i class="ri-heart-2-line"></i> 特别鸣谢</div>
              <ul class="credits-list">
                <li><span class="pill small name">ClassIsland</span> — 为本程序部分组件设计提供设计思路</li>
              </ul>
            </div>
          </div>
        </section>
        </section>
        <section id="page-npm" hidden>
          <header>
            <h1>依赖管理</h1>
            <p>仅展示已安装的Node模块及其版本（安装随插件进行）</p>
          </header>
          <div class="panel">
            <div id="npm-installed" class="npm-installed"></div>
          </div>
        </section>
        <!-- 安装确认模态框 -->
        <div id="install-modal" class="modal" hidden>
          <div class="modal-backdrop"></div>
          <div class="modal-dialog">
            <div class="modal-title"><i class="ri-shield-keyhole-line"></i> 安装安全提示</div>
            <div class="modal-body">
              <p>您正在安装第三方插件。插件可运行代码并访问应用接口，请确保其来自可信来源。</p>
              <!-- <p>若插件声明需要的 Node 模块未在本地存储，系统将尝试连接镜像站下载。无法连接时将提示无法安装，并提供手动导入指引。</p> -->
            </div>
            <div class="modal-actions">
              <button id="install-cancel" class="btn secondary"><i class="ri-close-line"></i> 取消</button>
              <button id="install-confirm" class="btn primary"><i class="ri-checkbox-circle-line"></i> 确认安装</button>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>
  <script src="./settings.js"></script>
</body>

</html>