<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self' data:; connect-src 'self'; frame-src 'self'">
  <title>日历背景</title>
  <style>
    html, body { height: 100%; margin: 0; background: #000; color: #e6e6e6; font-family: system-ui, Segoe UI, PingFang SC, Microsoft YaHei, sans-serif; }
    .wrap { height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .ym { font-size: 48px; font-weight: 700; letter-spacing: 1px; text-shadow: 0 2px 10px rgba(0,0,0,0.35); margin-bottom: 12px; }
    .week { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; width: min(92vw, 860px); font-size: 14px; color: #c8c8c8; }
    .grid { display: grid; grid-template-columns: repeat(7, 1fr); grid-auto-rows: 72px; gap: 8px; width: min(92vw, 860px); }
    .cell { display: flex; align-items: center; justify-content: center; border-radius: 10px; background: #101012; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.05); font-size: 20px; font-weight: 600; }
    .cell.outside { opacity: 0.35; }
    .cell.weekend { color: #d0d0ff; }
    .cell.today { color: #fff; box-shadow: 0 0 0 2px #4c8bf5 inset; }
  </style>
  <script>
    function qs(name){ const m = location.search.match(new RegExp('[?&]'+name+'=([^&]+)')); return m? decodeURIComponent(m[1]) : null; }
    const tz = qs('tz') || 'Asia/Shanghai';
    function daysInMonth(y, m){ return new Date(y, m+1, 0).getDate(); }
    function getWeekdayIndex(y,m,d){
      try {
        const label = new Intl.DateTimeFormat('en-US', { timeZone: tz, weekday: 'short' }).format(new Date(Date.UTC(y, m, d, 12)));
        return ({Sun:0,Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6})[label] ?? new Date(y, m, d).getDay();
      } catch { return new Date(y, m, d).getDay(); }
    }
    function render(){
      const now = new Date();
      let parts = null;
      try { parts = new Intl.DateTimeFormat('zh-CN', { timeZone: tz, year:'numeric', month:'2-digit', day:'2-digit' }).formatToParts(now); } catch {}
      const get = (t) => parts ? (parts.find(p=>p.type===t)?.value || '') : null;
      const curY = parts ? parseInt(get('year'),10) : now.getFullYear();
      const curM0 = parts ? (parseInt(get('month'),10)-1) : now.getMonth();
      const off = parseInt(qs('offset')||'0',10);
      let y = curY; let m = curM0;
      if (Number.isFinite(off)) { m += off; while (m < 0) { m += 12; y -= 1; } while (m >= 12) { m -= 12; y += 1; } }
      document.getElementById('ym').textContent = `${y}-${String(m+1).padStart(2,'0')}`;
      const firstWd = getWeekdayIndex(y, m, 1);
      const prevMonthDays = new Date(y, m, 0).getDate();
      const thisMonthDays = daysInMonth(y, m);
      const cells = [];
      // 前置上月天数
      for (let i=0;i<firstWd;i++) cells.push({ day: prevMonthDays-firstWd+i+1, outside: true });
      // 当月天数
      for (let d=1; d<=thisMonthDays; d++) cells.push({ day: d, outside: false });
      // 补齐到 6 行 * 7 列
      while (cells.length < 42) cells.push({ day: cells.length - (firstWd + thisMonthDays) + 1, outside: true });
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      for (let i=0;i<cells.length;i++){
        const { day, outside } = cells[i];
        const div = document.createElement('div');
        const col = i % 7;
        const isWeekend = (col===0 || col===6);
        const ty = curY; const tm = curM0; const td = parts ? parseInt(get('day'),10) : now.getDate();
        const isToday = (!outside && ty===y && tm===m && td===day);
        div.className = 'cell'+(outside?' outside':'')+(isWeekend?' weekend':'')+(isToday?' today':'');
        div.textContent = String(day);
        grid.appendChild(div);
      }
    }
    window.addEventListener('DOMContentLoaded', () => {
      // 周标题
      const weekEl = document.getElementById('week');
      const names = ['日','一','二','三','四','五','六'];
      weekEl.innerHTML = names.map(n => `<div style="text-align:center">${n}</div>`).join('');
      render();
    });
  </script>
</head>
<body>
  <div class="wrap">
    <div id="ym" class="ym">—</div>
    <div id="week" class="week"></div>
    <div id="grid" class="grid"></div>
  </div>
</body>
</html>