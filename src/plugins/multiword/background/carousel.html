<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>外部词库 · 轮播展示</title>
  <link rel="stylesheet" href="../../../renderer/remixicon-local.css" />
  <link rel="stylesheet" href="./carousel.css" />
  </head>
  <body>
  <div class="wrap">
    <div class="statusbar"><div class="left"><i class="ri-slideshow-line"></i><span>单词轮播</span></div><div class="right"><i class="ri-pages-line"></i><span id="pageInfo">--/--</span><i class="ri-time-line" style="margin-left:8px"></i><span id="timeLeft">--:--</span></div></div>
    <div class="stage">
      <div class="grid" id="grid"></div>
      <div id="redundants" class="redundants"></div>
      <div id="pageSeps" class="seps"></div>
      <div id="bottomSpacer" style="height:0"></div>
    </div>
  </div>
  <div class="controls-hint">通过底栏可控制轮播展示</div>
  <script src="./carousel.js"></script>
  <script>
    (function(){
      var t=null;var C=4;var origUpdate=typeof updatePageIndicator==='function'?updatePageIndicator:null;
      function rowH(){return Math.max(1,(lastItemH||60))+16}
      function pageStep(){try{var rows=Math.max(1,(lastRows||1));var pageH=rows*rowH()-16;var step=Math.max(rowH(),pageH-rowH());return step}catch{return rowH()}}
      function updateIndicatorStable(){try{var totalWords=Math.max(0,(words||[]).length);if(!totalWords){pageInfoEl.textContent='--/--';return}var idx=(typeof indicatorLockIdx!=='undefined'&&indicatorLockIdx!=null)?indicatorLockIdx:getCurrentPageIndex();var per=Math.max(1,Math.max(1,pageSize)-C);var startOrdinal=Math.max(1,Math.min(totalWords,idx*per+1));pageInfoEl.textContent=String(startOrdinal)+'/'+String(totalWords)}catch{try{origUpdate&&origUpdate()}catch{}}}
      window.updatePageIndicator=function(){try{if(t)clearTimeout(t)}catch{};t=setTimeout(updateIndicatorStable,160)}
      var origGetCurrent=typeof getCurrentPageIndex==='function'?getCurrentPageIndex:null;
      window.getCurrentPageIndex=function(){try{var h=pageStep();var base=(gridEl?.offsetTop||0);var pos=Math.max(0,(stageEl?.scrollTop||0)-base);var cur=Math.floor(pos/h);return Math.max(0,Math.min(totalPages()-1,cur))}catch{return origGetCurrent?origGetCurrent():0}}
      function useStepHeight(fn){var origGetH=typeof getPageHeight==='function'?getPageHeight:null;window.getPageHeight=function(){return pageStep()};try{fn()}finally{if(origGetH)window.getPageHeight=origGetH}}
      var origEnsure=typeof ensureScrollableToPage==='function'?ensureScrollableToPage:null;
      window.ensureScrollableToPage=function(idx){useStepHeight(function(){try{origEnsure&&origEnsure(idx)}catch{}})}
      var origPrev=typeof prevPage==='function'?prevPage:null;window.prevPage=function(){useStepHeight(function(){try{origPrev&&origPrev()}catch{}})}
      var origNext=typeof nextPage==='function'?nextPage:null;window.nextPage=function(){useStepHeight(function(){try{origNext&&origNext()}catch{}})}
      var origSep=typeof renderSeparators==='function'?renderSeparators:null;window.renderSeparators=function(){useStepHeight(function(){try{origSep&&origSep()}catch{}})}
      try{var st=document.querySelector('.stage');st&&st.addEventListener('scroll',function(){try{if(t)clearTimeout(t)}catch{};t=setTimeout(updateIndicatorStable,160)})}catch{}
    })();
  </script>
  </body>
  </html>
