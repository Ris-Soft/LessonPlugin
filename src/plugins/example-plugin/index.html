<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>基础示例</title>
    <link rel="stylesheet" href="../../renderer/remixicon-local.css" />
    <link rel="stylesheet" href="../../renderer/titlebar.css" />
    <link rel="stylesheet" href="../../renderer/settings.css" />
  </head>
  <body>
    <div class="titlebar">
      <div class="drag">基础示例</div>
      <div class="window-actions">
        <button class="win-btn" data-act="minimize" title="最小化"><i class="ri-subtract-line"></i></button>
        <button class="win-btn max" data-act="maximize" title="最大化"><i class="ri-checkbox-blank-line"></i></button>
        <button class="win-btn close" data-act="close" title="关闭"><i class="ri-close-line"></i></button>
      </div>
    </div>
    <div class="wrap">
      <div class="section">
        <div class="section-title"><i class="ri-puzzle-line"></i> 基础示例</div>
        <div class="muted">演示独立窗口能力与接口交互。</div>
        <div class="box">
          <strong>功能建议：</strong>
          <ul>
            <li>显示课堂计时或提醒</li>
            <li>展示课件或互动题目</li>
            <li>与主进程通信获取数据</li>
          </ul>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;">
          <button id="btn-register" class="btn secondary"><i class="ri-plug-line"></i> 注册功能</button>
          <button id="btn-emit" class="btn secondary"><i class="ri-notification-line"></i> 发送事件 basic:hello</button>
          <button id="btn-call" class="btn secondary"><i class="ri-exchange-line"></i> 调用 demo.utils:getTime</button>
        </div>
      </div>
      <div class="section">
        <div class="section-title"><i class="ri-file-list-3-line"></i> 日志</div>
        <div class="box" id="log"></div>
      </div>
    </div>
    <script>
      const log = (msg) => { const el = document.getElementById('log'); const p = document.createElement('div'); p.textContent = msg; el.appendChild(p); };
      document.querySelectorAll('.win-btn').forEach((b) => {
        b.addEventListener('click', () => {
          const act = b.dataset.act;
          window.pluginAPI?.windowControl(act);
        });
      });

      // 当被其他插件调用时执行
      window.pluginAPI?.onInvoke(async (fn, args) => {
        if (fn === 'hello') {
          return `Hello ${args?.[0] || ''}!`;
        }
        throw new Error('未知函数: ' + fn);
      });
      window.pluginAPI?.onEvent((name, payload) => { log(`[事件] ${name}: ${JSON.stringify(payload)}`); });

      document.getElementById('btn-register').addEventListener('click', () => {
        window.pluginAPI?.register('demo.basic', ['hello']);
        log('已注册函数: hello');
      });
      document.getElementById('btn-emit').addEventListener('click', async () => {
        const res = await window.pluginAPI?.emit('basic:hello', { msg: 'Hello from 基础示例' });
        log('事件发送完成: ' + JSON.stringify(res));
      });
      document.getElementById('btn-call').addEventListener('click', async () => {
        const res = await window.pluginAPI?.call('demo.utils', 'getTime', []);
        log('调用 UtilPlugin.getTime: ' + JSON.stringify(res));
      });
    </script>
  </body>
  </html>