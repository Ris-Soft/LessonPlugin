<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>听力设置</title>
    <link rel="stylesheet" href="../../../renderer/remixicon-local.css" />
    <style>
      body { margin:0; background:#0f1115; color:#e6e6e6; font-family: system-ui, Segoe UI, PingFang SC, Microsoft YaHei, sans-serif; }
      .wrap { padding: 12px; }
      .row { display:flex; align-items:center; gap:10px; margin-bottom:10px; }
      textarea { width:100%; height:140px; background:#0d0f14; color:#e6e6e6; border:1px solid #1f232b; border-radius:8px; padding:8px; }
      button { height:32px; padding:0 12px; background:#1f6feb; color:#fff; border:0; border-radius:6px; }
      .hint { font-size:12px; color:#a8b3c5; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="row"><i class="ri-time-line"></i><strong>定点播放时间（每行一个 HH:MM）</strong></div>
      <textarea id="times" placeholder="如 07:20\n19:30\n20:00"></textarea>
      <div class="hint">保存后到达设定时间将自动播放，并调用通知插件播放三声 in。</div>
      <div class="row"><button id="save">保存</button><button id="close" class="secondary">关闭</button></div>
    </div>
    <script>
      const api = () => window.lowbarAPI;
      async function init() {
        try { const r = await api().pluginCall('smart.listening','listScheduleTimes',[]); const list = (r && r.times) || []; document.getElementById('times').value = (list||[]).join('\n'); } catch {}
      }
      document.getElementById('save').addEventListener('click', async () => {
        const raw = document.getElementById('times').value || '';
        const lines = String(raw).split(/\r?\n/).map((s) => s.trim()).filter(Boolean);
        try { await api().pluginCall('smart.listening','setScheduleTimes',[lines]); alert('已保存'); } catch { alert('保存失败'); }
      });
      document.getElementById('close').addEventListener('click', () => { try { api().emitEvent('smart.listening.lowbar', { type:'click', id:'close-settings' }); api().emitEvent('smart.listening.lowbar', { type:'update', target:'floatingUrl', value: null }); } catch {} });
      init();
    </script>
  </body>
  </html>

