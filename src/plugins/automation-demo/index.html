<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Automation Demo</title>
  <link rel="stylesheet" href="../../renderer/remixicon-local.css" />
  <style>
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background: #0f172a; color: #e5e7eb; }
    header { display:flex; align-items:center; justify-content:space-between; padding: 8px 12px; background: #0b1324; border-bottom: 1px solid #1f2937; }
    .title { display:flex; align-items:center; gap:8px; }
    .title i { color: #22c55e; }
    .btns { display:flex; gap:8px; }
    .btn { padding: 6px 10px; background: #111827; color: #e5e7eb; border: 1px solid #374151; border-radius: 6px; cursor: pointer; }
    .btn:hover { border-color:#22c55e; color:#c3f1cf; }
    main { padding: 16px; }
    .box { background:#0b1324; border:1px solid #1f2937; border-radius:8px; padding:12px; margin-bottom:12px; }
    .log { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; white-space:pre-wrap; }
  </style>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const log = (msg) => { const el = document.getElementById('log'); const p = document.createElement('div'); p.textContent = msg; el.appendChild(p); };

      // 注册窗口内可调用函数（演示）
      window.pluginAPI?.onInvoke(async (fn, args) => {
        if (fn === 'echo') { return String(args?.[0] || ''); }
        throw new Error('未知函数: ' + fn);
      });

      // 订阅事件总线（演示）
      window.pluginAPI?.subscribe('AutomationDemo:event');
      window.pluginAPI?.onEvent((name, payload) => { log(`[事件] ${name}: ${JSON.stringify(payload)}`); });

      // 注册自动化事件（可选，主进程已通过导出自动注册）
      window.pluginAPI?.registerAutomationEvents?.('AutomationDemo', [
        { id: 'notify', name: 'notify', desc: '系统通知（标题、内容）', params: [ { name: 'title', type: 'string' }, { name: 'body', type: 'string' } ] },
        { id: 'logTime', name: 'logTime', desc: '将当前时间写入日志文件', params: [] }
      ]);

      document.getElementById('btn-notify').addEventListener('click', async () => {
        await window.pluginAPI?.call('AutomationDemo', 'notify', ['测试通知', '来自 AutomationDemo 的消息']);
        log('已发送系统通知');
      });
      document.getElementById('btn-log').addEventListener('click', async () => {
        const p = await window.pluginAPI?.call('AutomationDemo', 'logTime', []);
        log('已写入日志: ' + (p || '未知路径'));
      });
      document.querySelectorAll('.win-btn').forEach((b) => {
        b.addEventListener('click', () => window.pluginAPI?.windowControl(b.dataset.act));
      });
    });
  </script>
</head>
<body>
  <header>
    <div class="title"><i class="ri-robot-line"></i><strong>Automation Demo</strong></div>
    <div class="btns">
      <button class="btn win-btn" data-act="minimize"><i class="ri-subtract-line"></i></button>
      <button class="btn win-btn" data-act="maximize"><i class="ri-add-line"></i></button>
      <button class="btn win-btn" data-act="close"><i class="ri-close-line"></i></button>
    </div>
  </header>
  <main>
    <div class="box">
      <div>这是一个支持自动化的示例插件。无需打开窗口也可通过自动化调用后端函数。</div>
      <div style="margin-top:8px; display:flex; gap:8px;">
        <button class="btn" id="btn-notify"><i class="ri-notification-line"></i> 发送示例通知</button>
        <button class="btn" id="btn-log"><i class="ri-time-line"></i> 写入当前时间到日志</button>
      </div>
    </div>
    <div class="box log" id="log"></div>
  </main>
</body>
</html>